<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buoy Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #000000; --surface: #0a0a0a; --surface-elevated: #0f0f0f;
            --border: #1a1a1a; --border-bright: #2a2a2a;
            --text-primary: #ffffff; --text-secondary: #888888; --text-muted: #444444;
            --accent: #0ea5e9; --accent-glow: rgba(14, 165, 233, 0.2);
            --success: #10b981; --success-glow: rgba(16, 185, 129, 0.2);
            --warning: #f59e0b; --warning-glow: rgba(245, 158, 11, 0.2);
            --danger: #ef4444; --danger-glow: rgba(239, 68, 68, 0.2);
            --purple: #a855f7; --purple-glow: rgba(168, 85, 247, 0.2);
        }
        
        body {
            font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-primary);
            line-height: 1.5; -webkit-font-smoothing: antialiased;
            background-image: radial-gradient(circle at 20% 50%, rgba(14, 165, 233, 0.05) 0%, transparent 50%),
                              radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.05) 0%, transparent 50%);
            background-attachment: fixed;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }
        
        header {
            margin-bottom: 40px; padding-bottom: 25px; border-bottom: 1px solid var(--border); position: relative;
        }
        
        header::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100px; height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }
        
        h1 {
            font-size: 2rem; font-weight: 700; letter-spacing: -1px; margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #888888 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        .subtitle { font-size: 0.875rem; color: var(--text-secondary); font-weight: 500; }
        
        .status-row { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        
        .status-indicator {
            display: flex; align-items: center; gap: 10px; font-size: 0.813rem;
            font-family: 'JetBrains Mono', monospace; font-weight: 600; letter-spacing: 0.5px;
        }
        
        .dot {
            width: 8px; height: 8px; border-radius: 50%; background: var(--success);
            box-shadow: 0 0 12px var(--success-glow); animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.9); } }
        
        .time { font-family: 'JetBrains Mono', monospace; font-size: 0.813rem; color: var(--text-secondary); font-weight: 600; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .grid-2 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .widget {
            background: var(--surface); border: 1px solid var(--border); padding: 28px;
            transition: all 0.3s; position: relative; overflow: hidden;
        }
        
        .widget::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.03) 0%, transparent 50%);
            opacity: 0; transition: opacity 0.3s;
        }
        
        .widget:hover { border-color: var(--border-bright); transform: translateY(-2px); }
        .widget:hover::before { opacity: 1; }
        
        .widget-title {
            font-size: 0.688rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 18px;
        }
        
        .stat-value {
            font-size: 2.75rem; font-weight: 700; font-family: 'JetBrains Mono', monospace;
            letter-spacing: -2px; line-height: 1; position: relative; z-index: 1;
        }
        
        .stat-unit { font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px; font-weight: 500; }
        
        .data-list { display: flex; flex-direction: column; gap: 16px; }
        
        .data-item {
            display: flex; justify-content: space-between; align-items: baseline;
            padding-bottom: 16px; border-bottom: 1px solid var(--border);
        }
        
        .data-item:last-child { border-bottom: none; padding-bottom: 0; }
        
        .data-label { font-size: 0.813rem; color: var(--text-secondary); font-weight: 500; }
        .data-value { font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; font-weight: 600; }
        
        .badge {
            display: inline-block; padding: 4px 10px; font-size: 0.688rem;
            font-family: 'JetBrains Mono', monospace; font-weight: 700;
            text-transform: uppercase; border: 1.5px solid; letter-spacing: 0.5px;
        }
        
        .badge-success { color: var(--success); border-color: var(--success); background: rgba(16, 185, 129, 0.1); box-shadow: 0 0 15px var(--success-glow); }
        .badge-warning { color: var(--warning); border-color: var(--warning); background: rgba(245, 158, 11, 0.1); box-shadow: 0 0 15px var(--warning-glow); }
        .badge-danger { color: var(--danger); border-color: var(--danger); background: rgba(239, 68, 68, 0.1); box-shadow: 0 0 15px var(--danger-glow); }
        .badge-purple { color: var(--purple); border-color: var(--purple); background: rgba(168, 85, 247, 0.1); box-shadow: 0 0 15px var(--purple-glow); }
        .badge-neutral { color: var(--text-secondary); border-color: var(--border-bright); background: rgba(255, 255, 255, 0.05); }
        
        .chart-container { position: relative; height: 200px; }
        
        .alert-banner {
            position: fixed; top: 20px; right: 20px; padding: 18px 22px; background: var(--surface-elevated);
            border: 1px solid; max-width: 340px; z-index: 1000;
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); display: none;
        }
        
        @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        .alert-banner.show { display: block; }
        .alert-banner.alert-impact { border-color: var(--danger); box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3); }
        .alert-banner.alert-drift { border-color: var(--warning); box-shadow: 0 8px 32px rgba(245, 158, 11, 0.3); }
        
        .alert-banner-title { font-size: 0.875rem; font-weight: 700; margin-bottom: 6px; letter-spacing: 0.3px; }
        .alert-banner-text { font-size: 0.813rem; color: var(--text-secondary); font-weight: 500; }
        
        .text-success { color: var(--success); text-shadow: 0 0 20px var(--success-glow); }
        .text-warning { color: var(--warning); text-shadow: 0 0 20px var(--warning-glow); }
        .text-danger { color: var(--danger); text-shadow: 0 0 20px var(--danger-glow); }
        .text-accent { color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }
        .text-purple { color: var(--purple); text-shadow: 0 0 20px var(--purple-glow); }
        
        .event-widget {
            background: var(--surface); border: 2px solid var(--border); padding: 50px 40px;
            text-align: center; position: relative; overflow: hidden; transition: all 0.4s;
        }
        
        .event-widget::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px;
            background: var(--text-muted); transition: all 0.4s;
        }
        
        .event-widget.event-impact::before { background: var(--danger); box-shadow: 0 0 20px var(--danger-glow); }
        .event-widget.event-drift::before { background: var(--warning); box-shadow: 0 0 20px var(--warning-glow); }
        .event-widget.event-status::before { background: var(--accent); box-shadow: 0 0 20px var(--accent-glow); }
        .event-widget.event-waiting::before { background: var(--text-muted); }
        
        .event-label {
            font-size: 0.688rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 20px;
        }
        
        .buoy-status-big {
            font-size: 1.1rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
            margin-bottom: 25px; padding: 10px 24px; display: inline-block;
            border: 2px solid; transition: all 0.3s;
        }
        
        .buoy-status-big.standby { color: var(--purple); border-color: var(--purple); background: rgba(168, 85, 247, 0.1); box-shadow: 0 0 25px var(--purple-glow); }
        .buoy-status-big.deploying { color: var(--warning); border-color: var(--warning); background: rgba(245, 158, 11, 0.1); box-shadow: 0 0 25px var(--warning-glow); animation: pulse-glow 2s infinite; }
        .buoy-status-big.deployed { color: var(--success); border-color: var(--success); background: rgba(16, 185, 129, 0.1); box-shadow: 0 0 25px var(--success-glow); }
        .buoy-status-big.override { color: var(--warning); border-color: var(--warning); background: rgba(245, 158, 11, 0.15); box-shadow: 0 0 25px var(--warning-glow); animation: pulse-glow 1.5s infinite; }
        
        .buoy-status-big.offline { color: var(--danger); border-color: var(--danger); background: rgba(239, 68, 68, 0.15); box-shadow: 0 0 25px var(--danger-glow); animation: pulse-glow 1s infinite; }
        
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 25px var(--warning-glow); } 50% { box-shadow: 0 0 35px var(--warning-glow), 0 0 50px var(--warning-glow); } }
        
        .event-type-big {
            font-size: 4.5rem; font-weight: 800; font-family: 'JetBrains Mono', monospace;
            letter-spacing: -3px; line-height: 1; margin-bottom: 16px; transition: all 0.3s;
        }
        
        .event-description { font-size: 1.05rem; color: var(--text-secondary); margin-bottom: 28px; font-weight: 500; }
        
        .event-magnitude-display {
            display: inline-block; padding: 14px 28px; background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-bright); font-family: 'JetBrains Mono', monospace;
            font-size: 1.6rem; font-weight: 700; margin-top: 10px; letter-spacing: -0.5px;
        }
        
        footer {
            margin-top: 60px; padding-top: 30px; border-top: 1px solid var(--border);
            text-align: center; color: var(--text-secondary); font-size: 0.813rem;
        }
        
        .developer-name { font-weight: 700; color: var(--text-primary); }
        .instagram-link { color: var(--accent); text-decoration: none; transition: color 0.2s; font-weight: 600; }
        .instagram-link:hover { color: var(--text-primary); }
        
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .container { padding: 20px 16px; }
            h1 { font-size: 1.75rem; }
            .event-widget { padding: 35px 25px; }
            .event-type-big { font-size: 3rem; }
            .buoy-status-big { font-size: 0.95rem; padding: 8px 18px; }
            .event-magnitude-display { font-size: 1.3rem; padding: 12px 22px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Buoy Monitoring System</h1>
            <p class="subtitle">Real-time seismic buoy data stream</p>
            <div class="status-row">
                <div class="status-indicator"><div class="dot"></div><span>LIVE</span></div>
                <div class="time" id="currentTime">--:--:--</div>
            </div>
        </header>
        
        <div class="event-widget event-waiting" id="eventWidget">
            <div class="event-label">Current Event</div>
            <div class="buoy-status-big standby" id="buoyStatusBig">STANDBY</div>
            <div class="event-type-big" id="eventTypeBig">WAITING</div>
            <div class="event-description" id="eventDescriptionBig">No events detected</div>
            <div class="event-magnitude-display" id="magnitudeBig">0.000 m/s²</div>
        </div>
        
        <br>
        
        <div class="grid">
            <div class="widget"><div class="widget-title">Event Type</div><div class="stat-value" id="eventType">--</div><div class="stat-unit" id="eventSubtype">Waiting for data</div></div>
            <div class="widget"><div class="widget-title">Magnitude</div><div class="stat-value" id="magnitude">--</div><div class="stat-unit">m/s² or meters</div></div>
            <div class="widget"><div class="widget-title">Signal Strength</div><div class="stat-value" id="rssi">--</div><div class="stat-unit">dBm</div></div>
            <div class="widget"><div class="widget-title">Total Events</div><div class="stat-value" id="eventCount">0</div><div class="stat-unit">recorded</div></div>
        </div>
        
        <div class="grid-2">
            <div class="widget">
                <div class="widget-title">Magnitude History</div>
                <div class="chart-container"><canvas id="magnitudeChart"></canvas></div>
            </div>
            <div class="widget">
                <div class="widget-title">System Status</div>
                <div class="data-list">
                    <div class="data-item"><span class="data-label">Buoy Status</span><span class="data-value" id="buoyStatus">--</span></div>
                    <div class="data-item"><span class="data-label">GPS Status</span><span class="data-value" id="gpsStatus">--</span></div>
                    <div class="data-item"><span class="data-label">Last Update</span><span class="data-value" id="lastUpdate">--</span></div>
                </div>
            </div>
        </div>
        
        <div class="grid">
            <div class="widget">
                <div class="widget-title">GPS Coordinates</div>
                <div class="data-list">
                    <div class="data-item"><span class="data-label">Latitude</span><span class="data-value" id="latitude">--</span></div>
                    <div class="data-item"><span class="data-label">Longitude</span><span class="data-value" id="longitude">--</span></div>
                </div>
            </div>
            <div class="widget">
                <div class="widget-title">Debug Info</div>
                <div class="data-list">
                    <div class="data-item"><span class="data-label">Raw Data</span><span class="data-value" id="debugInfo">--</span></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Developed by <span class="developer-name">Muhammad Irfan</span></p>
            <p><a href="https://instagram.com/hzetronics" target="_blank" class="instagram-link">@hzetronics</a></p>
        </footer>
    </div>
    
    <div class="alert-banner" id="alertBanner">
        <div class="alert-banner-title" id="alertTitle"></div>
        <div class="alert-banner-text" id="alertText"></div>
    </div>

    <script>
        const CHANNEL_ID = '3203006', READ_API_KEY = 'JN2TR7S7XJLS9TWW', REFRESH_INTERVAL = 15000;
        const API_URL = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds/last.json?api_key=${READ_API_KEY}`;
        const RECEIVER_TIMEOUT = 45000; // 45 seconds - receiver considered offline if no updates
        
        let lastUpdateTime = Date.now();
        let receiverOnline = true;
        
        const ctx = document.getElementById('magnitudeChart').getContext('2d');
        const magnitudeData = [], maxDataPoints = 20;
        
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ data: [], borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', borderWidth: 2, tension: 0.4, pointRadius: 0, pointHoverRadius: 5, fill: true }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.9)', padding: 10, displayColors: false, callbacks: { title: () => '', label: (c) => `${c.parsed.y.toFixed(3)} m/s²` } } }, scales: { x: { display: false }, y: { border: { display: false }, grid: { color: '#1a1a1a', drawTicks: false }, ticks: { color: '#888888', font: { size: 10, family: 'JetBrains Mono' }, padding: 8, callback: (v) => v.toFixed(2) } } }, interaction: { intersect: false, mode: 'index' } }
        });
        
        let previousData = {};
        
        function updateClock() {
            const now = new Date();
            document.getElementById('currentTime').textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
        }
        setInterval(updateClock, 1000); updateClock();
        
        function showAlert(title, text, type = 'impact') {
            const banner = document.getElementById('alertBanner');
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertText').textContent = text;
            banner.className = 'alert-banner show alert-' + type;
            setTimeout(() => banner.classList.remove('show'), 5000);
        }
        
        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                if (!data || !data.created_at) return;
                
                // Check if data is fresh (updated recently)
                const dataTime = new Date(data.created_at).getTime();
                const now = Date.now();
                const dataAge = now - dataTime;
                
                // If data is older than 45 seconds, receiver might be offline
                if (dataAge > RECEIVER_TIMEOUT) {
                    if (receiverOnline) {
                        receiverOnline = false;
                        showAlert('⚠️ RECEIVER OFFLINE', 'WiFi connection lost or receiver stopped', 'impact');
                        document.querySelector('.dot').style.background = 'var(--danger)';
                    }
                } else {
                    if (!receiverOnline) {
                        receiverOnline = true;
                        showAlert('✅ RECEIVER ONLINE', 'Connection restored', 'drift');
                        document.querySelector('.dot').style.background = 'var(--success)';
                    }
                    lastUpdateTime = now;
                }
                
                const eventTypeCode = parseInt(data.field1) || 3;
                const magnitude = parseFloat(data.field2) || 0;
                const latitude = parseFloat(data.field3) || 0;
                const longitude = parseFloat(data.field4) || 0;
                const rssi = parseInt(data.field5) || 0;
                const gpsValid = parseInt(data.field6) || 0;
                const eventCount = parseInt(data.field7) || 0;
                const buoyStatusCode = parseInt(data.field8) || 1;
                
                // Map buoy status (1=Standby, 2=Deploying, 3=Deployed, 4=Override, 5=Offline)
                let buoyStatusText = 'STANDBY', buoyStatusClass = 'standby';
                if (buoyStatusCode === 2) { buoyStatusText = 'DEPLOYING'; buoyStatusClass = 'deploying'; }
                else if (buoyStatusCode === 3) { buoyStatusText = 'DEPLOYED'; buoyStatusClass = 'deployed'; }
                else if (buoyStatusCode === 4) { buoyStatusText = 'OVERRIDE'; buoyStatusClass = 'override'; }
                else if (buoyStatusCode === 5) { buoyStatusText = 'BUOY OFFLINE'; buoyStatusClass = 'offline'; }
                
                document.getElementById('debugInfo').textContent = `Type:${eventTypeCode} Mag:${magnitude} GPS:${gpsValid} Status:${buoyStatusCode} (${buoyStatusText}) Age:${Math.floor(dataAge/1000)}s`;
                
                let eventType = 'WAITING', eventSubtype = 'No events', eventColor = 'text-accent';
                if (eventTypeCode === 1) { eventType = 'IMPACT'; eventSubtype = 'High acceleration detected'; eventColor = 'text-danger'; }
                else if (eventTypeCode === 2) { eventType = 'DRIFT'; eventSubtype = 'Position or orientation change'; eventColor = 'text-warning'; }
                else if (eventTypeCode === 3) { eventType = 'STATUS'; eventSubtype = 'System status update'; eventColor = 'text-accent'; }
                
                if (previousData.eventCount !== undefined && eventCount > previousData.eventCount) {
                    if (eventTypeCode === 1) showAlert('⚠️ IMPACT DETECTED', `Magnitude: ${magnitude.toFixed(2)} m/s²`, 'impact');
                    else if (eventTypeCode === 2) showAlert('⚠️ DRIFT DETECTED', `Distance/Change: ${magnitude.toFixed(2)} m`, 'drift');
                }
                
                // Check for buoy going offline
                if (previousData.buoyStatusCode !== undefined && previousData.buoyStatusCode !== 5 && buoyStatusCode === 5) {
                    showAlert('❌ BUOY OFFLINE', 'Transmitter signal lost', 'impact');
                }
                
                // Check for buoy coming back online
                if (previousData.buoyStatusCode !== undefined && previousData.buoyStatusCode === 5 && buoyStatusCode !== 5) {
                    showAlert('✅ BUOY ONLINE', 'Transmitter signal restored', 'drift');
                }
                
                const eventTypeEl = document.getElementById('eventType');
                eventTypeEl.textContent = eventType; eventTypeEl.className = `stat-value ${eventColor}`;
                document.getElementById('eventSubtype').textContent = eventSubtype;
                
                const eventWidget = document.getElementById('eventWidget');
                const eventTypeBig = document.getElementById('eventTypeBig');
                const eventDescriptionBig = document.getElementById('eventDescriptionBig');
                const magnitudeBig = document.getElementById('magnitudeBig');
                const buoyStatusBig = document.getElementById('buoyStatusBig');
                
                buoyStatusBig.textContent = buoyStatusText;
                buoyStatusBig.className = `buoy-status-big ${buoyStatusClass}`;
                
                eventWidget.classList.remove('event-impact', 'event-drift', 'event-status', 'event-waiting');
                
                if (eventTypeCode === 1) {
                    eventWidget.classList.add('event-impact');
                    eventTypeBig.className = 'event-type-big text-danger';
                    magnitudeBig.textContent = magnitude.toFixed(2) + ' m/s²';
                } else if (eventTypeCode === 2) {
                    eventWidget.classList.add('event-drift');
                    eventTypeBig.className = 'event-type-big text-warning';
                    magnitudeBig.textContent = magnitude.toFixed(2) + ' m';
                } else if (eventTypeCode === 3) {
                    eventWidget.classList.add('event-status');
                    eventTypeBig.className = 'event-type-big text-accent';
                    magnitudeBig.textContent = magnitude.toFixed(3) + ' m/s²';
                } else {
                    eventWidget.classList.add('event-waiting');
                    eventTypeBig.className = 'event-type-big';
                    magnitudeBig.textContent = '0.000';
                }
                
                eventTypeBig.textContent = eventType;
                eventDescriptionBig.textContent = eventSubtype;
                
                document.getElementById('magnitude').textContent = magnitude.toFixed(3);
                document.getElementById('rssi').textContent = rssi;
                document.getElementById('eventCount').textContent = eventCount;
                
                const buoyStatusEl = document.getElementById('buoyStatus');
                if (buoyStatusCode === 1) buoyStatusEl.innerHTML = '<span class="badge badge-purple">STANDBY</span>';
                else if (buoyStatusCode === 2) buoyStatusEl.innerHTML = '<span class="badge badge-warning">DEPLOYING</span>';
                else if (buoyStatusCode === 3) buoyStatusEl.innerHTML = '<span class="badge badge-success">DEPLOYED</span>';
                else if (buoyStatusCode === 4) buoyStatusEl.innerHTML = '<span class="badge badge-warning">OVERRIDE</span>';
                else if (buoyStatusCode === 5) buoyStatusEl.innerHTML = '<span class="badge badge-danger">BUOY OFFLINE</span>';
                else buoyStatusEl.innerHTML = '<span class="badge badge-neutral">UNKNOWN</span>';
                
                const gpsEl = document.getElementById('gpsStatus');
                if (gpsValid === 1) gpsEl.innerHTML = '<span class="badge badge-success">LOCKED</span>';
                else gpsEl.innerHTML = '<span class="badge badge-danger">NO LOCK</span>';
                
                if (latitude !== 0 && longitude !== 0 && gpsValid === 1) {
                    document.getElementById('latitude').textContent = latitude.toFixed(6) + '°';
                    document.getElementById('longitude').textContent = longitude.toFixed(6) + '°';
                } else {
                    document.getElementById('latitude').textContent = 'NO DATA';
                    document.getElementById('longitude').textContent = 'NO DATA';
                }
                
                const updateTime = new Date(data.created_at);
                document.getElementById('lastUpdate').textContent = updateTime.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                if (magnitude > 0 || eventTypeCode !== 3) {
                    magnitudeData.push(magnitude);
                    if (magnitudeData.length > maxDataPoints) magnitudeData.shift();
                    chart.data.labels = magnitudeData.map((_, i) => i + 1);
                    chart.data.datasets[0].data = magnitudeData;
                    chart.update('none');
                }
                
                previousData = { eventCount, eventTypeCode, buoyStatusCode };
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('debugInfo').textContent = 'ERROR: ' + error.message;
                if (receiverOnline) {
                    receiverOnline = false;
                    showAlert('⚠️ CONNECTION ERROR', 'Failed to fetch data', 'impact');
                    document.querySelector('.dot').style.background = 'var(--danger)';
                }
            }
        }
        
        fetchData();
        setInterval(fetchData, REFRESH_INTERVAL);
    </script>
</body>
</html>
