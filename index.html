<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buoy Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0f0f0f; --surface: #1c1c1e; --surface-elevated: #2c2c2e;
            --border: #38383a; --border-bright: #48484a;
            --text-primary: #ffffff; --text-secondary: #98989d; --text-muted: #636366;
            --accent: #007aff; --accent-glow: rgba(0, 122, 255, 0.25);
            --accent-light: #5ac8fa;
            --success: #34c759; --success-glow: rgba(52, 199, 89, 0.25);
            --warning: #ff9500; --warning-glow: rgba(255, 149, 0, 0.25);
            --danger: #ff3b30; --danger-glow: rgba(255, 59, 48, 0.25);
            --purple: #af52de; --purple-glow: rgba(175, 82, 222, 0.25);
            --grid-color: rgba(255, 255, 255, 0.02);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: var(--bg); color: var(--text-primary);
            line-height: 1.6; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
            background-image: radial-gradient(circle at 20% 50%, rgba(0, 122, 255, 0.03) 0%, transparent 50%),
                              radial-gradient(circle at 80% 80%, rgba(52, 199, 89, 0.02) 0%, transparent 50%);
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animated grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 60px 60px;
            animation: gridScroll 30s linear infinite;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }
        
        @keyframes gridScroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(60px); }
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; position: relative; z-index: 1; }
        
        /* Status History Timeline */
        .timeline-panel {
            position: fixed;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: var(--surface);
            border-right: 1px solid var(--border);
            transform: translateX(-320px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .timeline-panel.open {
            transform: translateX(0);
        }
        
        .timeline-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timeline-title {
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-primary);
        }
        
        .timeline-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .timeline-close:hover {
            background: var(--border);
            color: var(--text-primary);
        }
        
        .timeline-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
        }
        
        .timeline-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .timeline-content::-webkit-scrollbar-track {
            background: var(--surface);
        }
        
        .timeline-content::-webkit-scrollbar-thumb {
            background: var(--border-bright);
            border-radius: 3px;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 32px;
            padding-bottom: 24px;
            animation: slideInLeft 0.4s ease-out;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 6px;
            top: 6px;
            bottom: -24px;
            width: 2px;
            background: var(--border);
        }
        
        .timeline-item:last-child::before {
            display: none;
        }
        
        .timeline-dot {
            position: absolute;
            left: 0;
            top: 4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid;
            background: var(--surface);
            z-index: 1;
        }
        
        .timeline-dot.impact { border-color: var(--danger); background: var(--danger); }
        .timeline-dot.drift { border-color: var(--warning); background: var(--warning); }
        .timeline-dot.status { border-color: var(--accent); background: var(--accent); }
        .timeline-dot.success { border-color: var(--success); background: var(--success); }
        
        .timeline-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            margin-bottom: 4px;
        }
        
        .timeline-event {
            font-size: 0.813rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .timeline-details {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .timeline-toggle {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: none;
            border-radius: 0 8px 8px 0;
            padding: 20px 10px;
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 700;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }
        
        .timeline-toggle:hover {
            background: var(--surface-elevated);
            padding-right: 14px;
            color: var(--text-primary);
            box-shadow: 3px 0 12px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        header {
            margin-bottom: 48px; padding-bottom: 32px; 
            border-bottom: 1px solid var(--border); 
            position: relative;
            animation: slideDown 0.6s ease-out;
        }
        
        header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 120px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }
        
        header::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100px; height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }
        
        h1 {
            font-family: 'Inter', sans-serif;
            font-size: 2.75rem; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 12px;
            text-transform: uppercase;
            color: var(--text-primary);
            line-height: 1;
        }
        
        .subtitle { 
            font-size: 0.938rem; 
            color: var(--text-secondary); 
            font-weight: 500; 
            letter-spacing: 0.02em; 
        }
        
        .status-row { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        
        .countdown-widget {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 10px 18px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.813rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .countdown-label {
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.75rem;
        }
        
        .countdown-timer {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 42px;
            text-align: center;
        }
        
        .countdown-progress {
            width: 40px;
            height: 40px;
            position: relative;
        }
        
        .countdown-circle {
            transform: rotate(-90deg);
        }
        
        .countdown-circle-bg {
            fill: none;
            stroke: var(--border);
            stroke-width: 3;
        }
        
        .countdown-circle-progress {
            fill: none;
            stroke: var(--accent);
            stroke-width: 3;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s linear;
        }
        
        .status-indicator {
            display: flex; align-items: center; gap: 10px; font-size: 0.813rem;
            font-family: 'JetBrains Mono', monospace; font-weight: 600; letter-spacing: 0.5px;
            position: relative;
        }
        
        .dot {
            width: 8px; height: 8px; border-radius: 50%; background: var(--success);
            box-shadow: 0 0 12px var(--success-glow); animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.9); } }
        
        .time { font-family: 'JetBrains Mono', monospace; font-size: 0.813rem; color: var(--text-secondary); font-weight: 600; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .grid-2 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .widget {
            background: var(--surface); 
            border: 1px solid var(--border); 
            padding: 32px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative; 
            overflow: hidden;
            border-radius: 16px;
            animation: fadeInUp 0.6s ease-out backwards;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        
        /* 3D Flip Animation */
        .widget.flipping {
            animation: flipCard 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes flipCard {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); opacity: 0.5; }
            100% { transform: rotateY(0deg); }
        }
        
        @keyframes fadeInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .widget:nth-child(1) { animation-delay: 0.05s; }
        .widget:nth-child(2) { animation-delay: 0.1s; }
        .widget:nth-child(3) { animation-delay: 0.15s; }
        .widget:nth-child(4) { animation-delay: 0.2s; }
        .widget:nth-child(5) { animation-delay: 0.25s; }
        .widget:nth-child(6) { animation-delay: 0.3s; }
        
        /* Progress Ring */
        .progress-ring {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 48px;
            height: 48px;
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            fill: none;
            stroke: var(--border);
            stroke-width: 3;
        }
        
        .progress-ring-progress {
            fill: none;
            stroke: var(--accent);
            stroke-width: 3;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
        }
        
        .progress-ring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(90deg);
            font-size: 0.625rem;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
        }
        
        .widget::before {
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.03) 0%, transparent 50%);
            opacity: 0; 
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .widget::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--accent);
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .widget:hover { 
            border-color: var(--border-bright); 
            transform: translateY(-4px); 
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);
        }
        .widget:hover::before { opacity: 1; }
        .widget:hover::after { left: 0; }
        
        .widget-title {
            font-size: 0.688rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 18px;
        }
        
        .stat-value {
            font-size: 3rem; 
            font-weight: 700; 
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: -0.02em; 
            line-height: 1; 
            position: relative; 
            z-index: 1;
            color: var(--text-primary);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-unit { font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px; font-weight: 500; }
        
        .data-list { display: flex; flex-direction: column; gap: 16px; }
        
        .data-item {
            display: flex; justify-content: space-between; align-items: baseline;
            padding-bottom: 16px; border-bottom: 1px solid var(--border);
        }
        
        .data-item:last-child { border-bottom: none; padding-bottom: 0; }
        
        .data-label { font-size: 0.813rem; color: var(--text-secondary); font-weight: 500; transition: color 0.3s ease; }
        .data-value { font-family: 'IBM Plex Mono', monospace; font-size: 0.938rem; font-weight: 600; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .badge {
            display: inline-block; 
            padding: 6px 14px; 
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif; 
            font-weight: 600;
            text-transform: uppercase; 
            border: 1.5px solid; 
            letter-spacing: 0.03em;
            border-radius: 6px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .badge-success { 
            color: var(--success); 
            border-color: var(--success); 
            background: rgba(52, 199, 89, 0.12); 
            box-shadow: 0 0 12px var(--success-glow); 
        }
        .badge-warning { 
            color: var(--warning); 
            border-color: var(--warning); 
            background: rgba(255, 149, 0, 0.12); 
            box-shadow: 0 0 12px var(--warning-glow); 
        }
        .badge-danger { 
            color: var(--danger); 
            border-color: var(--danger); 
            background: rgba(255, 59, 48, 0.12); 
            box-shadow: 0 0 12px var(--danger-glow);
            animation: alertPulse 2s ease-in-out infinite;
        }
        .badge-purple { 
            color: var(--purple); 
            border-color: var(--purple); 
            background: rgba(175, 82, 222, 0.12); 
            box-shadow: 0 0 12px var(--purple-glow); 
        }
        .badge-blue { 
            color: var(--accent); 
            border-color: var(--accent); 
            background: rgba(0, 122, 255, 0.12); 
            box-shadow: 0 0 12px var(--accent-glow); 
        }
        .badge-neutral { 
            color: var(--text-secondary); 
            border-color: var(--border-bright); 
            background: rgba(255, 255, 255, 0.04); 
        }
        
        @keyframes alertPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.75; }
        }
        
        .chart-container { position: relative; height: 200px; }
        
        .alert-banner {
            position: fixed; 
            top: 24px; 
            right: 24px; 
            padding: 20px 24px; 
            background: var(--surface-elevated);
            border: 1px solid; 
            max-width: 360px; 
            z-index: 1000;
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6); 
            display: none;
            border-radius: 12px;
        }
        
        @keyframes slideIn { 
            from { transform: translateX(120%); opacity: 0; } 
            to { transform: translateX(0); opacity: 1; } 
        }
        
        .alert-banner.show { display: block; }
        .alert-banner.alert-impact { 
            border-color: var(--danger); 
            box-shadow: 0 12px 48px rgba(255, 59, 48, 0.3); 
        }
        .alert-banner.alert-drift { 
            border-color: var(--warning); 
            box-shadow: 0 12px 48px rgba(255, 149, 0, 0.3); 
        }
        
        .alert-banner-title { 
            font-size: 0.938rem; 
            font-weight: 700; 
            margin-bottom: 8px; 
            letter-spacing: 0.01em; 
        }
        .alert-banner-text { 
            font-size: 0.875rem; 
            color: var(--text-secondary); 
            font-weight: 500; 
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .dismiss-button {
            width: 100%;
            padding: 10px;
            margin-top: 12px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.813rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none;
        }
        
        .alert-drift .dismiss-button {
            background: var(--warning);
        }
        
        .alert-drift .dismiss-button:hover {
            background: #ffad33;
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.4);
        }
        
        .dismiss-button:hover {
            background: #ff6b5e;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.4);
        }
        
        .dismiss-button:active {
            transform: translateY(0);
        }
        
        /* Update animation indicator */
        .status-indicator::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            border: 2px solid var(--success);
            border-radius: 50%;
            opacity: 0;
            animation: none;
        }
        
        .status-indicator.updating::after {
            animation: updatePulse 1s ease-out;
        }
        
        @keyframes updatePulse {
            0% { 
                width: 8px; 
                height: 8px; 
                opacity: 1; 
            }
            100% { 
                width: 32px; 
                height: 32px; 
                opacity: 0; 
            }
        }
        
        /* Alert Mode Styling */
        .alert-mode .event-widget {
            animation: alertBlinkContinuous 3s infinite;
        }
        
        @keyframes alertBlinkContinuous {
            /* 1 second of blinking (5 blinks at 200ms each) */
            0%, 6.67% { 
                background: var(--danger);
                border-color: var(--danger);
            }
            10%, 16.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            20%, 26.67% { 
                background: var(--danger);
                border-color: var(--danger);
            }
            30%, 36.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            40%, 46.67% { 
                background: var(--danger);
                border-color: var(--danger);
            }
            50%, 56.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            60%, 66.67% { 
                background: var(--danger);
                border-color: var(--danger);
            }
            70%, 76.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            80%, 86.67% { 
                background: var(--danger);
                border-color: var(--danger);
            }
            /* 2 seconds solid red (remaining 66.67% of cycle) */
            90%, 100% { 
                background: var(--danger);
                border-color: var(--danger);
            }
        }
        
        .alert-mode.drift-alert .event-widget {
            animation: alertBlinkContinuousOrange 3s infinite;
        }
        
        @keyframes alertBlinkContinuousOrange {
            /* 1 second of blinking (5 blinks at 200ms each) */
            0%, 6.67% { 
                background: var(--warning);
                border-color: var(--warning);
            }
            10%, 16.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            20%, 26.67% { 
                background: var(--warning);
                border-color: var(--warning);
            }
            30%, 36.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            40%, 46.67% { 
                background: var(--warning);
                border-color: var(--warning);
            }
            50%, 56.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            60%, 66.67% { 
                background: var(--warning);
                border-color: var(--warning);
            }
            70%, 76.67% { 
                background: var(--surface);
                border-color: var(--border);
            }
            80%, 86.67% { 
                background: var(--warning);
                border-color: var(--warning);
            }
            /* 2 seconds solid orange (remaining 66.67% of cycle) */
            90%, 100% { 
                background: var(--warning);
                border-color: var(--warning);
            }
        }
        
        .alert-mode .event-widget .event-type-big,
        .alert-mode .event-widget .event-description,
        .alert-mode .event-widget .event-magnitude-display,
        .alert-mode .event-widget .event-label {
            color: #000000 !important;
        }
        
        .alert-mode .event-widget .buoy-status-big {
            background: rgba(0, 0, 0, 0.2) !important;
            color: #000000 !important;
            border-color: #000000 !important;
        }
        
        .maintenance-button {
            position: fixed;
            bottom: 32px;
            right: 32px;
            padding: 16px 32px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.938rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            z-index: 1001;
            box-shadow: 0 8px 24px rgba(255, 59, 48, 0.4);
        }
        
        .maintenance-button:hover {
            background: #ff6b5e;
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(255, 59, 48, 0.5);
        }
        
        .maintenance-button:active {
            transform: translateY(0);
        }
        
        .maintenance-button.show {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        @keyframes slideUp {
            from { transform: translateY(120px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .text-success { color: var(--success); text-shadow: 0 0 12px var(--success-glow); }
        .text-warning { color: var(--warning); text-shadow: 0 0 12px var(--warning-glow); }
        .text-danger { color: var(--danger); text-shadow: 0 0 12px var(--danger-glow); }
        .text-accent { color: var(--accent); text-shadow: 0 0 12px var(--accent-glow); }
        .text-purple { color: var(--purple); text-shadow: 0 0 12px var(--purple-glow); }
        
        .event-widget {
            background: var(--surface); 
            border: 1px solid var(--border); 
            padding: 56px 48px;
            text-align: center; 
            position: relative; 
            overflow: hidden; 
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .event-widget::before {
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 3px;
            background: var(--text-muted); 
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .event-widget.event-impact::before { 
            background: var(--danger); 
            box-shadow: 0 0 20px var(--danger-glow); 
        }
        .event-widget.event-drift::before { 
            background: var(--warning); 
            box-shadow: 0 0 20px var(--warning-glow); 
        }
        .event-widget.event-status::before { 
            background: var(--accent); 
            box-shadow: 0 0 20px var(--accent-glow); 
        }
        .event-widget.event-waiting::before { background: var(--text-muted); }
        
        .event-label {
            font-size: 0.688rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 20px;
        }
        
        .buoy-status-big {
            font-family: 'Inter', sans-serif;
            font-size: 1rem; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 0.08em;
            margin-bottom: 28px; 
            padding: 10px 24px; 
            display: inline-block;
            border: 2px solid; 
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); 
            border-radius: 8px;
        }
        
        .buoy-status-big.standby { 
            color: var(--accent); 
            border-color: var(--accent); 
            background: rgba(0, 122, 255, 0.12); 
            box-shadow: 0 0 20px var(--accent-glow);
            animation: statusFadeIn 0.6s ease-out;
        }
        .buoy-status-big.deploying { 
            color: var(--purple); 
            border-color: var(--purple); 
            background: rgba(175, 82, 222, 0.12); 
            box-shadow: 0 0 20px var(--purple-glow); 
            animation: pulse-glow-purple 2s infinite;
        }
        .buoy-status-big.deployed { 
            color: var(--success); 
            border-color: var(--success); 
            background: rgba(52, 199, 89, 0.12); 
            box-shadow: 0 0 20px var(--success-glow);
            animation: statusFadeIn 0.6s ease-out;
        }
        .buoy-status-big.override { 
            color: var(--warning); 
            border-color: var(--warning); 
            background: rgba(255, 149, 0, 0.15); 
            box-shadow: 0 0 20px var(--warning-glow); 
            animation: pulse-glow-orange 1.5s infinite; 
        }
        .buoy-status-big.offline { 
            color: var(--danger); 
            border-color: var(--danger); 
            background: rgba(255, 59, 48, 0.15); 
            box-shadow: 0 0 20px var(--danger-glow); 
            animation: pulse-glow-red 1s infinite; 
        }
        
        @keyframes pulse-glow-purple { 
            0%, 100% { 
                box-shadow: 0 0 20px var(--purple-glow); 
                transform: scale(1);
            } 
            50% { 
                box-shadow: 0 0 30px var(--purple-glow), 0 0 45px var(--purple-glow);
                transform: scale(1.02);
            } 
        }
        
        @keyframes pulse-glow-orange { 
            0%, 100% { 
                box-shadow: 0 0 20px var(--warning-glow); 
                transform: scale(1);
            } 
            50% { 
                box-shadow: 0 0 30px var(--warning-glow), 0 0 45px var(--warning-glow);
                transform: scale(1.02);
            } 
        }
        
        @keyframes pulse-glow-red { 
            0%, 100% { 
                box-shadow: 0 0 20px var(--danger-glow); 
                transform: scale(1);
            } 
            50% { 
                box-shadow: 0 0 30px var(--danger-glow), 0 0 45px var(--danger-glow);
                transform: scale(1.02);
            } 
        }
        
        @keyframes statusFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .event-type-big {
            font-family: 'Inter', sans-serif;
            font-size: 4.5rem; 
            font-weight: 900; 
            letter-spacing: -0.04em; 
            line-height: 1; 
            margin-bottom: 20px; 
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            color: currentColor;
        }
        }
        
        .event-description { 
            font-size: 1.063rem; 
            color: var(--text-secondary); 
            margin-bottom: 32px; 
            font-weight: 500; 
            line-height: 1.5;
        }
        
        .event-magnitude-display {
            display: inline-block; 
            padding: 16px 32px; 
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-bright); 
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.75rem; 
            font-weight: 600; 
            margin-top: 12px; 
            letter-spacing: -0.01em;
            border-radius: 8px;
        }
        
        /* Colored accent widgets */
        .widget[data-accent="impact"] {
            border-left: 3px solid var(--danger);
        }
        
        .widget[data-accent="signal"] {
            border-left: 3px solid var(--success);
        }
        
        .widget[data-accent="gps"] {
            border-left: 3px solid var(--accent);
        }
        
        .widget[data-accent="status"] {
            border-left: 3px solid var(--purple);
        }
        
        footer {
            margin-top: 60px; padding-top: 30px; border-top: 1px solid var(--border);
            text-align: center; color: var(--text-secondary); font-size: 0.813rem;
        }
        
        .developer-name { font-weight: 700; color: var(--text-primary); }
        .instagram-link { color: var(--accent); text-decoration: none; transition: color 0.2s; font-weight: 600; }
        .instagram-link:hover { color: var(--text-primary); }
        
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .container { padding: 20px 16px; }
            h1 { font-size: 1.75rem; }
            .event-widget { padding: 35px 25px; }
            .event-type-big { font-size: 3rem; }
            .buoy-status-big { font-size: 0.95rem; padding: 8px 18px; }
            .event-magnitude-display { font-size: 1.3rem; padding: 12px 22px; }
        }
    </style>
</head>
<body>
    <!-- Timeline Toggle Button -->
    <button class="timeline-toggle" onclick="toggleTimeline()" id="timelineToggle">
        ◀
    </button>
    
    <!-- Status History Timeline Panel -->
    <div class="timeline-panel" id="timelinePanel">
        <div class="timeline-header">
            <div class="timeline-title">Event History</div>
            <button class="timeline-close" onclick="toggleTimeline()">×</button>
        </div>
        <div class="timeline-content" id="timelineContent">
            <div style="text-align: center; color: var(--text-muted); padding: 40px 0;">
                <div style="font-size: 0.813rem;">No events yet</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>Wave32 <span style="font-size: 0.5em; font-weight: 600; color: var(--warning); vertical-align: super; letter-spacing: 0.05em;">BETA</span></h1>
            <p class="subtitle">LoRa Marine Monitoring Node • Real-Time Telemetry Dashboard</p>
            <div class="status-row">
                <div class="status-indicator"><div class="dot"></div><span>LIVE</span></div>
                <div class="countdown-widget">
                    <div class="countdown-progress">
                        <svg width="40" height="40" class="countdown-circle">
                            <circle class="countdown-circle-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="countdown-circle-progress" id="countdownCircle" cx="20" cy="20" r="16" 
                                    stroke-dasharray="100.53" stroke-dashoffset="0"></circle>
                        </svg>
                    </div>
                    <div>
                        <div class="countdown-label">Next Update</div>
                        <div class="countdown-timer" id="countdownTimer">15s</div>
                    </div>
                </div>
                <div class="time" id="currentTime">--:--:--</div>
            </div>
        </header>
        
        <div class="event-widget event-waiting" id="eventWidget">
            <div class="event-label">Current Event</div>
            <div class="buoy-status-big standby" id="buoyStatusBig">STANDBY</div>
            <div class="event-type-big" id="eventTypeBig">WAITING</div>
            <div class="event-description" id="eventDescriptionBig">No events detected</div>
            <div class="event-magnitude-display" id="magnitudeBig">0.000 m/s²</div>
        </div>
        
        <br>
        
        <div class="grid">
            <div class="widget" data-accent="impact">
                <svg class="progress-ring" id="eventTypeRing">
                    <circle class="progress-ring-circle" cx="24" cy="24" r="20"></circle>
                    <circle class="progress-ring-progress" cx="24" cy="24" r="20"></circle>
                </svg>
                <div class="widget-title">Event Type</div>
                <div class="stat-value" id="eventType">--</div>
                <div class="stat-unit" id="eventSubtype">Waiting for data</div>
            </div>
            <div class="widget" data-accent="impact">
                <svg class="progress-ring" id="magnitudeRing">
                    <circle class="progress-ring-circle" cx="24" cy="24" r="20"></circle>
                    <circle class="progress-ring-progress" cx="24" cy="24" r="20"></circle>
                </svg>
                <div class="widget-title">Magnitude</div>
                <div class="stat-value" id="magnitude">--</div>
                <div class="stat-unit">m/s² or meters</div>
            </div>
            <div class="widget" data-accent="signal">
                <svg class="progress-ring" id="rssiRing">
                    <circle class="progress-ring-circle" cx="24" cy="24" r="20"></circle>
                    <circle class="progress-ring-progress" cx="24" cy="24" r="20"></circle>
                </svg>
                <div class="widget-title">Signal Strength</div>
                <div class="stat-value" id="rssi">--</div>
                <div class="stat-unit">dBm</div>
            </div>
            <div class="widget">
                <svg class="progress-ring" id="eventCountRing">
                    <circle class="progress-ring-circle" cx="24" cy="24" r="20"></circle>
                    <circle class="progress-ring-progress" cx="24" cy="24" r="20"></circle>
                </svg>
                <div class="widget-title">Total Events</div>
                <div class="stat-value" id="eventCount">0</div>
                <div class="stat-unit">recorded</div>
            </div>
        </div>
        
        <div class="grid-2">
            <div class="widget">
                <div class="widget-title">Magnitude History</div>
                <div class="chart-container"><canvas id="magnitudeChart"></canvas></div>
            </div>
            <div class="widget" data-accent="status">
                <div class="widget-title">System Status</div>
                <div class="data-list">
                    <div class="data-item"><span class="data-label">Buoy Status</span><span class="data-value" id="buoyStatus">--</span></div>
                    <div class="data-item"><span class="data-label">GPS Status</span><span class="data-value" id="gpsStatus">--</span></div>
                    <div class="data-item"><span class="data-label">Last Update</span><span class="data-value" id="lastUpdate">--</span></div>
                </div>
            </div>
        </div>
        
        <div class="grid">
            <div class="widget" data-accent="gps">
                <div class="widget-title">GPS Coordinates</div>
                <div class="data-list">
                    <div class="data-item"><span class="data-label">Latitude</span><span class="data-value" id="latitude">--</span></div>
                    <div class="data-item"><span class="data-label">Longitude</span><span class="data-value" id="longitude">--</span></div>
                </div>
            </div>
            <div class="widget">
                <div class="widget-title">Debug Info</div>
                <div class="data-list">
                    <div class="data-item"><span class="data-label">Raw Data</span><span class="data-value" id="debugInfo">--</span></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Developed by <span class="developer-name">Muhammad Irfan</span></p>
            <p><a href="https://instagram.com/hzetronics" target="_blank" class="instagram-link">@hzetronics</a></p>
        </footer>
    </div>
    
    <div class="alert-banner" id="alertBanner">
        <div class="alert-banner-title" id="alertTitle"></div>
        <div class="alert-banner-text" id="alertText"></div>
        <button class="dismiss-button" id="dismissButton" onclick="dismissAlert()">Acknowledge</button>
    </div>
    
    <button class="maintenance-button" id="maintenanceButton" onclick="sendMaintenance()">
        Send Maintenance
    </button>

    <script>
        const CHANNEL_ID = '3203006', READ_API_KEY = 'JN2TR7S7XJLS9TWW', REFRESH_INTERVAL = 15000;
        const API_URL = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds/last.json?api_key=${READ_API_KEY}`;
        const RECEIVER_TIMEOUT = 45000; // 45 seconds - receiver considered offline if no updates
        
        let lastUpdateTime = Date.now();
        let receiverOnline = true;
        let impactAlertActive = false; // Track if critical alert is showing
        let lastImpactEventCount = -1; // Track last impact event count
        let lastDriftEventCount = -1; // Track last drift event count
        let countdownSeconds = 15; // Countdown from 15 seconds
        let lastFetchTime = Date.now(); // Track when last fetch happened
        let alertMode = false; // Track if system is in alert mode (impact/drift/offline)
        let alertModeType = ''; // Track type of alert (impact, drift, offline)
        let eventHistory = []; // Store event history for timeline
        const MAX_HISTORY = 50; // Maximum events to keep
        
        const ctx = document.getElementById('magnitudeChart').getContext('2d');
        const magnitudeData = [], maxDataPoints = 20;
        
        // Timeline Functions
        function toggleTimeline() {
            const panel = document.getElementById('timelinePanel');
            const toggle = document.getElementById('timelineToggle');
            panel.classList.toggle('open');
            
            // Update toggle button arrow direction
            if (panel.classList.contains('open')) {
                toggle.textContent = '▶';
            } else {
                toggle.textContent = '◀';
            }
        }
        
        function addToTimeline(eventType, message, details = '') {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            
            const event = {
                time: timeString,
                type: eventType,
                message: message,
                details: details,
                timestamp: now.getTime()
            };
            
            eventHistory.unshift(event); // Add to beginning
            if (eventHistory.length > MAX_HISTORY) {
                eventHistory.pop(); // Remove oldest
            }
            
            updateTimelineDisplay();
        }
        
        function updateTimelineDisplay() {
            const content = document.getElementById('timelineContent');
            
            if (eventHistory.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 40px 0;">
                        <div style="font-size: 0.813rem;">No events yet</div>
                    </div>
                `;
                return;
            }
            
            content.innerHTML = eventHistory.map(event => `
                <div class="timeline-item">
                    <div class="timeline-dot ${event.type}"></div>
                    <div class="timeline-time">${event.time}</div>
                    <div class="timeline-event">${event.message}</div>
                    ${event.details ? `<div class="timeline-details">${event.details}</div>` : ''}
                </div>
            `).join('');
        }
        
        // 3D Flip Card Animation
        function flipWidget(widgetElement) {
            widgetElement.classList.add('flipping');
            setTimeout(() => {
                widgetElement.classList.remove('flipping');
            }, 600);
        }
        
        // Progress Ring Update
        function updateProgressRing(elementId, percentage, color = 'var(--accent)') {
            const ring = document.getElementById(elementId);
            if (!ring) return;
            
            const circle = ring.querySelector('.progress-ring-progress');
            const text = ring.querySelector('.progress-ring-text');
            
            if (circle) {
                const circumference = 2 * Math.PI * 20; // radius = 20
                const offset = circumference - (percentage / 100) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
                circle.style.stroke = color;
            }
            
            if (text) {
                text.textContent = Math.round(percentage) + '%';
            }
        }
        
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ data: [], borderColor: '#007aff', backgroundColor: 'rgba(0, 122, 255, 0.1)', borderWidth: 2.5, tension: 0.4, pointRadius: 0, pointHoverRadius: 6, fill: true, pointBackgroundColor: '#007aff', pointBorderColor: '#007aff' }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(28, 28, 30, 0.98)', borderColor: '#007aff', borderWidth: 1, padding: 14, displayColors: false, titleColor: '#007aff', titleFont: { size: 12, weight: '600', family: 'Inter' }, bodyColor: '#ffffff', bodyFont: { size: 13, weight: '500', family: 'IBM Plex Mono' }, callbacks: { title: () => '', label: (c) => `${c.parsed.y.toFixed(3)} m/s²` } } }, scales: { x: { display: false }, y: { border: { display: false }, grid: { color: '#38383a', drawTicks: false }, ticks: { color: '#98989d', font: { size: 11, family: 'IBM Plex Mono', weight: '500' }, padding: 10, callback: (v) => v.toFixed(2) } } }, interaction: { intersect: false, mode: 'index' } }
        });
        
        let previousData = {};
        
        function updateClock() {
            const now = new Date();
            document.getElementById('currentTime').textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
        }
        setInterval(updateClock, 1000); updateClock();
        
        function showAlert(title, text, type = 'impact') {
            const banner = document.getElementById('alertBanner');
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertText').textContent = text;
            banner.className = 'alert-banner show alert-' + type;
            
            // Add to timeline
            let timelineType = 'status';
            if (title.includes('IMPACT')) timelineType = 'impact';
            else if (title.includes('DRIFT')) timelineType = 'drift';
            else if (title.includes('OFFLINE')) timelineType = 'impact';
            else if (title.includes('ONLINE')) timelineType = 'success';
            
            addToTimeline(timelineType, title, text);
            
            // Make impact, drift, offline, and receiver offline alerts persistent with dismiss button
            if ((type === 'impact' && (title.includes('IMPACT DETECTED') || title.includes('OFFLINE'))) || 
                (type === 'drift' && title.includes('DRIFT DETECTED'))) {
                impactAlertActive = true;
                document.getElementById('dismissButton').style.display = 'block';
                
                // Activate alert mode
                alertMode = true;
                if (title.includes('DRIFT')) {
                    alertModeType = 'drift';
                    document.body.classList.add('alert-mode', 'drift-alert');
                } else {
                    alertModeType = 'impact';
                    document.body.classList.add('alert-mode');
                    document.body.classList.remove('drift-alert');
                }
                
                // Show maintenance button
                document.getElementById('maintenanceButton').classList.add('show');
                
                // Don't auto-hide critical alerts
            } else {
                document.getElementById('dismissButton').style.display = 'none';
                setTimeout(() => {
                    if (!impactAlertActive) { // Only hide if not an active critical alert
                        banner.classList.remove('show');
                    }
                }, 5000);
            }
        }
        
        function dismissAlert() {
            const banner = document.getElementById('alertBanner');
            banner.classList.remove('show');
            impactAlertActive = false;
        }
        
        function sendMaintenance() {
            // Exit alert mode
            alertMode = false;
            alertModeType = '';
            document.body.classList.remove('alert-mode', 'drift-alert');
            document.getElementById('maintenanceButton').classList.remove('show');
            
            // Also dismiss the alert banner
            dismissAlert();
            
            // Show confirmation
            showAlert('✅ MAINTENANCE SENT', 'System returned to normal monitoring mode', 'drift');
        }
        
        function updateCountdown() {
            const elapsed = Date.now() - lastFetchTime;
            const remaining = Math.max(0, Math.ceil((REFRESH_INTERVAL - elapsed) / 1000));
            
            countdownSeconds = remaining;
            
            // Update timer text
            document.getElementById('countdownTimer').textContent = remaining + 's';
            
            // Update progress circle
            const circumference = 100.53; // 2 * PI * radius (16)
            const progress = (remaining / 15) * circumference;
            document.getElementById('countdownCircle').style.strokeDashoffset = circumference - progress;
            
            // Change color based on time remaining
            const circle = document.getElementById('countdownCircle');
            if (remaining <= 3) {
                circle.style.stroke = 'var(--danger)';
            } else if (remaining <= 7) {
                circle.style.stroke = 'var(--warning)';
            } else {
                circle.style.stroke = 'var(--accent)';
            }
        }
        
        // Update countdown every second
        setInterval(updateCountdown, 1000);
        
        async function fetchData() {
            try {
                lastFetchTime = Date.now(); // Reset countdown timer
                countdownSeconds = 15;
                
                const response = await fetch(API_URL);
                const data = await response.json();
                if (!data || !data.created_at) return;
                
                // Check if data is fresh (updated recently)
                const dataTime = new Date(data.created_at).getTime();
                const now = Date.now();
                const dataAge = now - dataTime;
                
                // If data is older than 45 seconds, receiver might be offline
                if (dataAge > RECEIVER_TIMEOUT) {
                    if (receiverOnline) {
                        receiverOnline = false;
                        showAlert('⚠️ RECEIVER OFFLINE', 'WiFi connection lost or receiver stopped', 'impact');
                        document.querySelector('.dot').style.background = 'var(--danger)';
                    }
                } else {
                    if (!receiverOnline) {
                        receiverOnline = true;
                        showAlert('✅ RECEIVER ONLINE', 'Connection restored', 'drift');
                        document.querySelector('.dot').style.background = 'var(--success)';
                    }
                    lastUpdateTime = now;
                    
                    // Trigger update animation
                    const statusIndicator = document.querySelector('.status-indicator');
                    statusIndicator.classList.add('updating');
                    setTimeout(() => statusIndicator.classList.remove('updating'), 1000);
                }
                
                const eventTypeCode = parseInt(data.field1) || 3;
                const magnitude = parseFloat(data.field2) || 0;
                const latitude = parseFloat(data.field3) || 0;
                const longitude = parseFloat(data.field4) || 0;
                const rssi = parseInt(data.field5) || 0;
                const gpsValid = parseInt(data.field6) || 0;
                const eventCount = parseInt(data.field7) || 0;
                const buoyStatusCode = parseInt(data.field8) || 1;
                
                // Map buoy status (1=Standby, 2=Deploying, 3=Deployed, 4=Override, 5=Receiver Active, 6=Buoy Offline)
                let buoyStatusText = 'STANDBY', buoyStatusClass = 'standby';
                if (buoyStatusCode === 2) { buoyStatusText = 'DEPLOYING'; buoyStatusClass = 'deploying'; }
                else if (buoyStatusCode === 3) { buoyStatusText = 'DEPLOYED'; buoyStatusClass = 'deployed'; }
                else if (buoyStatusCode === 4) { buoyStatusText = 'OVERRIDE'; buoyStatusClass = 'override'; }
                else if (buoyStatusCode === 5) { buoyStatusText = 'RECEIVER ACTIVE'; buoyStatusClass = 'deployed'; }
                else if (buoyStatusCode === 6) { buoyStatusText = 'BUOY OFFLINE'; buoyStatusClass = 'offline'; }
                
                document.getElementById('debugInfo').textContent = `Type:${eventTypeCode} Mag:${magnitude} GPS:${gpsValid} Status:${buoyStatusCode} (${buoyStatusText}) Age:${Math.floor(dataAge/1000)}s`;
                
                let eventType = 'WAITING', eventSubtype = 'No events', eventColor = 'text-accent';
                if (eventTypeCode === 0) { eventType = 'HEARTBEAT'; eventSubtype = 'System heartbeat - all systems operational'; eventColor = 'text-accent'; }
                else if (eventTypeCode === 1) { eventType = 'IMPACT'; eventSubtype = 'High acceleration detected'; eventColor = 'text-danger'; }
                else if (eventTypeCode === 2) { eventType = 'DRIFT'; eventSubtype = 'Position or orientation change'; eventColor = 'text-warning'; }
                else if (eventTypeCode === 3) { eventType = 'STATUS'; eventSubtype = 'System status update'; eventColor = 'text-accent'; }
                
                if (previousData.eventCount !== undefined && eventCount > previousData.eventCount) {
                    if (eventTypeCode === 1) {
                        // Only show impact alert if it's a new impact event
                        if (eventCount !== lastImpactEventCount) {
                            showAlert('⚠️ IMPACT DETECTED', `Magnitude: ${magnitude.toFixed(2)} m/s²`, 'impact');
                            lastImpactEventCount = eventCount;
                        }
                    }
                    else if (eventTypeCode === 2) {
                        // Only show drift alert if it's a new drift event
                        if (eventCount !== lastDriftEventCount) {
                            showAlert('⚠️ DRIFT DETECTED', `Distance/Change: ${magnitude.toFixed(2)} m`, 'drift');
                            lastDriftEventCount = eventCount;
                        }
                    }
                    // Note: Heartbeat (eventTypeCode === 0) and Status (eventTypeCode === 3) don't show alerts
                }
                
                // Check for buoy going offline
                if (previousData.buoyStatusCode !== undefined && previousData.buoyStatusCode !== 6 && buoyStatusCode === 6) {
                    showAlert('❌ BUOY OFFLINE', 'Transmitter signal lost', 'impact');
                }
                
                // Check for buoy coming back online
                if (previousData.buoyStatusCode !== undefined && previousData.buoyStatusCode === 6 && buoyStatusCode !== 6) {
                    showAlert('✅ BUOY ONLINE', 'Transmitter signal restored', 'drift');
                }
                
                const eventTypeEl = document.getElementById('eventType');
                eventTypeEl.textContent = eventType; eventTypeEl.className = `stat-value ${eventColor}`;
                document.getElementById('eventSubtype').textContent = eventSubtype;
                
                // Trigger 3D flip on stat widgets when values change
                if (previousData.eventTypeCode !== undefined && eventTypeCode !== previousData.eventTypeCode) {
                    const widgets = document.querySelectorAll('.grid .widget');
                    widgets.forEach((widget, index) => {
                        setTimeout(() => flipWidget(widget), index * 100);
                    });
                }
                
                const eventWidget = document.getElementById('eventWidget');
                const eventTypeBig = document.getElementById('eventTypeBig');
                const eventDescriptionBig = document.getElementById('eventDescriptionBig');
                const magnitudeBig = document.getElementById('magnitudeBig');
                const buoyStatusBig = document.getElementById('buoyStatusBig');
                
                buoyStatusBig.textContent = buoyStatusText;
                buoyStatusBig.className = `buoy-status-big ${buoyStatusClass}`;
                
                eventWidget.classList.remove('event-impact', 'event-drift', 'event-status', 'event-waiting');
                
                if (eventTypeCode === 0) {
                    eventWidget.classList.add('event-status');
                    eventTypeBig.className = 'event-type-big text-accent';
                    magnitudeBig.textContent = 'ACTIVE';
                } else if (eventTypeCode === 1) {
                    eventWidget.classList.add('event-impact');
                    eventTypeBig.className = 'event-type-big text-danger';
                    magnitudeBig.textContent = magnitude.toFixed(2) + ' m/s²';
                } else if (eventTypeCode === 2) {
                    eventWidget.classList.add('event-drift');
                    eventTypeBig.className = 'event-type-big text-warning';
                    magnitudeBig.textContent = magnitude.toFixed(2) + ' m';
                } else if (eventTypeCode === 3) {
                    eventWidget.classList.add('event-status');
                    eventTypeBig.className = 'event-type-big text-accent';
                    magnitudeBig.textContent = magnitude.toFixed(3) + ' m/s²';
                } else {
                    eventWidget.classList.add('event-waiting');
                    eventTypeBig.className = 'event-type-big';
                    magnitudeBig.textContent = '0.000';
                }
                
                eventTypeBig.textContent = eventType;
                eventDescriptionBig.textContent = eventSubtype;
                
                document.getElementById('magnitude').textContent = magnitude.toFixed(3);
                document.getElementById('rssi').textContent = rssi;
                document.getElementById('eventCount').textContent = eventCount;
                
                // Update Progress Rings
                // RSSI: -120 to -30 dBm range (better signal = higher percentage)
                const rssiPercentage = Math.max(0, Math.min(100, ((rssi + 120) / 90) * 100));
                updateProgressRing('rssiRing', rssiPercentage, rssi > -70 ? 'var(--success)' : rssi > -90 ? 'var(--warning)' : 'var(--danger)');
                
                // Event Count: show as percentage of max (assume 100 events max)
                const eventCountPercentage = Math.min(100, (eventCount / 100) * 100);
                updateProgressRing('eventCountRing', eventCountPercentage, 'var(--accent)');
                
                // Magnitude: 0-10 m/s² range
                const magnitudePercentage = Math.min(100, (magnitude / 10) * 100);
                updateProgressRing('magnitudeRing', magnitudePercentage, magnitude > 5 ? 'var(--danger)' : magnitude > 2 ? 'var(--warning)' : 'var(--success)');
                
                // Event Type: visual indicator (33%, 66%, 100% based on severity)
                let eventTypePercentage = 33;
                if (eventTypeCode === 1) eventTypePercentage = 100; // Impact = full
                else if (eventTypeCode === 2) eventTypePercentage = 66; // Drift = 2/3
                else if (eventTypeCode === 3 || eventTypeCode === 0) eventTypePercentage = 33; // Status/Heartbeat = 1/3
                updateProgressRing('eventTypeRing', eventTypePercentage, 
                    eventTypeCode === 1 ? 'var(--danger)' : eventTypeCode === 2 ? 'var(--warning)' : 'var(--accent)');
                
                const buoyStatusEl = document.getElementById('buoyStatus');
                if (buoyStatusCode === 1) buoyStatusEl.innerHTML = '<span class="badge badge-blue">STANDBY</span>';
                else if (buoyStatusCode === 2) buoyStatusEl.innerHTML = '<span class="badge badge-purple">DEPLOYING</span>';
                else if (buoyStatusCode === 3) buoyStatusEl.innerHTML = '<span class="badge badge-success">DEPLOYED</span>';
                else if (buoyStatusCode === 4) buoyStatusEl.innerHTML = '<span class="badge badge-warning">OVERRIDE</span>';
                else if (buoyStatusCode === 5) buoyStatusEl.innerHTML = '<span class="badge badge-success">RECEIVER ACTIVE</span>';
                else if (buoyStatusCode === 6) buoyStatusEl.innerHTML = '<span class="badge badge-danger">BUOY OFFLINE</span>';
                else buoyStatusEl.innerHTML = '<span class="badge badge-neutral">UNKNOWN</span>';
                
                const gpsEl = document.getElementById('gpsStatus');
                if (gpsValid === 1) gpsEl.innerHTML = '<span class="badge badge-success">LOCKED</span>';
                else gpsEl.innerHTML = '<span class="badge badge-danger">NO LOCK</span>';
                
                if (latitude !== 0 && longitude !== 0 && gpsValid === 1) {
                    document.getElementById('latitude').textContent = latitude.toFixed(6) + '°';
                    document.getElementById('longitude').textContent = longitude.toFixed(6) + '°';
                } else {
                    document.getElementById('latitude').textContent = 'NO DATA';
                    document.getElementById('longitude').textContent = 'NO DATA';
                }
                
                const updateTime = new Date(data.created_at);
                document.getElementById('lastUpdate').textContent = updateTime.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                if (magnitude > 0 && eventTypeCode !== 0 && eventTypeCode !== 3) {
                    magnitudeData.push(magnitude);
                    if (magnitudeData.length > maxDataPoints) magnitudeData.shift();
                    chart.data.labels = magnitudeData.map((_, i) => i + 1);
                    chart.data.datasets[0].data = magnitudeData;
                    chart.update('none');
                }
                
                previousData = { eventCount, eventTypeCode, buoyStatusCode };
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('debugInfo').textContent = 'ERROR: ' + error.message;
                if (receiverOnline) {
                    receiverOnline = false;
                    showAlert('⚠️ CONNECTION ERROR', 'Failed to fetch data', 'impact');
                    document.querySelector('.dot').style.background = 'var(--danger)';
                }
            }
        }
        
        fetchData();
        setInterval(fetchData, REFRESH_INTERVAL);
    </script>
</body>
</html>
